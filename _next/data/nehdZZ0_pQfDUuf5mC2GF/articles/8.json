{"pageProps":{"post":{"slug":"8","content":"この記事では RibbonCMS の初回セットアップ実行している `tie.sh` というシェルスクリプトについて、何をやっているのかをコードベースで解説します（実は、初回セットアップのほとんどはこの `tie.sh` で行われています）。\n\n`tie.sh` のコードはこちらで確認できます:\n\n> https://github.com/RibbonCMS/RibbonCMS/blob/main/tie.sh\n\n## `tie.sh` を実行する前に…\n\n`tie.sh` を実行する前にまず private リポジトリの新規作成と `tie.sh` のダウンロードが必要です。次のセットアップページをもとに `tie.sh` を実行する前まで手順を完了させてください:\n\n<!-- [RibbonCMS のセットアップ | RibbonCMS](https://ribboncms.github.io/articles/5) -->\n\n#5 \n\n## STEP 1 ｜ RibbonCMS/RibbonCMS の複製\n\n```\n  git clone --bare git@github.com:RibbonCMS/RibbonCMS.git ./$REPO_NAME.git\n  cd ./$REPO_NAME.git\n  git push --mirror git@github.com:$USER_NAME/$REPO_NAME.git\n```\n\nここでは先ほど作成した自分用 CMS リポジトリへ[RibbonCMS/RibbonCMS](https://github.com/RibbonCMS/RibbonCMS)の完全なコピー（ファイルだけでなくブランチやタグ等も含むリポジトリ自体の複製）を作成しています。\n\n`--bare` や `--mirror` オプションについては次の記事をご覧ください:\n\n> 参考: [git clone 時の mirror と bare の違い | exMedia](https://www.exmedia.jp/blog/git-clone%E6%99%82%E3%81%AEmirror%E3%81%A8bare%E3%81%AE%E9%81%95%E3%81%84/)\n\nなお、 fork ではなくリポジトリの複製という方法を採っている理由は、 fork だと issue の作成が行えないためです。\n\n## STEP 2 ｜ローカルリポジトリの削除\n\n```\n  cd ..\n  rm -rf ./$REPO_NAME.git\n```\n\n先ほどの push が完了したら、もうローカルリポジトリは不要なので削除しておきます。\n\n## STEP 3 ｜ 自分用 CMS リポジトリを clone\n\n```\n  git clone git@github.com:$USER_NAME/$REPO_NAME.git\n  cd ./$REPO_NAME\n```\n\n## STEP 4 ｜環境設定ファイルを作成\n\n```\n  GITHUB_USER_NAME=$(git config user.name)\n  GITHUB_USER_EMAIL=$(git config user.email)\n  echo \"#!/bin/bash\" >| ./settings.conf\n  echo \"GITHUB_USER_NAME='$GITHUB_USER_NAME'\" >> ./settings.conf\n  echo \"GITHUB_USER_EMAIL='$GITHUB_USER_EMAIL'\" >> ./settings.conf\n  echo \"FRONTEND_REPOSITORY='$SIDE_F_REPO'\" >> ./settings.conf\n  echo \"SIDE_M_REPOSITORY='$SIDE_M_REPO'\" >> ./settings.conf\n```\n\nRibbonCMS の環境設定ファイルを作成しています。処理としては `settings.conf` に次の 4 つの環境変数を記述しています。\n\n| 環境変数              | 役割                                                                                                     |\n| --------------------- | -------------------------------------------------------------------------------------------------------- |\n| `GITHUB_USER_NAME`    | GitHub のユーザ名を格納します                                                                            |\n| `GITHUB_USER_EMAIL`   | GitHub に登録されているメールアドレスを格納します                                                        |\n| `FRONTEND_REPOSITORY` | sideF に利用するテンプレートのリポジトリ名を格納します（デフォルトでは `RibbonCMS/SimpleBlogTemplate` ） |\n| `SIDE_M_REPOSITORY`   | sideM に利用するテンプレートのリポジトリ名を格納します（デフォルトでは `RibbonCMS/RibbonCMS_sideM` ）    |\n\n`settings.conf` の内容はこの後実行する `setup.sh` で使います。\n\n## STEP 5 ｜セットアップスクリプトを実行\n\n```\n  ./setup.sh\n```\n\nセットアップスクリプト `setup.sh` を実行しています。コードはこちらから確認できます:\n\n> https://github.com/RibbonCMS/RibbonCMS/blob/main/setup.sh\n\n`setup.sh` で行っていることは主に次の通りです:\n\n- 記事投稿用 GitHub Actions ワークフロー `issue_builder.yml` の作成\n- sideF リポジトリに用意されている issue テンプレート（記事投稿用など）を自分用 CMS リポジトリの `ISSUE_TEMPLATE/` へコピー\n\n`issue_builder.yml` の作成では次の処理を行っています:\n\n1. `issue_builder.yml` のテンプレートである `templates/workflows/issue_builder.yml` に先ほど作成した `settings.conf` の内容を反映\n1. 反映した `issue_builder.yml` を自分用 CMS リポジトリの`.github/workflows/`に配置\n\n`setup.sh` 内の該当コードを下記に示します:\n\n```\nsource ./settings.conf\n\nissue_builder='./templates/workflows/issue_builder.yml'\nworkflow=$(cat $issue_builder)\nworkflow=$(echo \"$workflow\" | sed -e \"s|T_GITHUB_USER_NAME|${GITHUB_USER_NAME}|g\")\nworkflow=$(echo \"$workflow\" | sed -e \"s|T_GITHUB_USER_EMAIL|${GITHUB_USER_EMAIL}|g\")\nworkflow=$(echo \"$workflow\" | sed -e \"s|T_FRONTEND_REPOSITORY|${FRONTEND_REPOSITORY}|g\")\nworkflow=$(echo \"$workflow\" | sed -e \"s|T_SIDE_M_REPOSITORY|${SIDE_M_REPOSITORY}|g\")\nif [ ! -d ./.github/workflows ]; then\n    mkdir -p ./.github/workflows\nfi\nif [ -e ./.github/workflows/issue_builder.yml ]; then\n    read -p \"cp: overwrite './.github/workflows/issue_builder.yml'? \" prompt;\n    if [ $prompt = 'y' ]; then\n        echo \"$workflow\" >| ./.github/workflows/issue_builder.yml\n    fi\nelse\n    echo \"$workflow\" >| ./.github/workflows/issue_builder.yml\nfi\n```\n\n`templates/workflows/issue_builder.yml` の中身はこちら:\n\n> https://github.com/RibbonCMS/RibbonCMS/blob/main/templates/workflows/issue_builder.yml\n\n`ISSUE_TEMPLATE/` へのコピーでは次の処理を行っています:\n\n1. sideF リポジトリを clone\n1. sideF リポジトリの `templates/issues/` 内にある issue テンプレートを自分用 CMS リポジトリの `ISSUE_TEMPLATE/` へコピー\n\nどのような issue テンプレートがあるかは sideF リポジトリによって異なります。例えば、 FunctionalBlogTemplate には次のような issue テンプレートが用意されています:\n\n> https://github.com/RibbonCMS/FunctionalBlogTemplate/tree/main/templates/issues\n\n## STEP 6 ｜これまでの変更を自分用 CMS リポジトリへ反映\n\n```\n  git add .\n  git commit -m 'exec first setup.sh'\n  git push origin main\n```\n\n以上が `tie.sh` が行っている内容です。\n\n\n","title":"セットアップで実行している `tie.sh` は何をやっているのか？","posted_at":"2023年07月26日 01時15分","updated_at":"2023年07月30日 14時42分","tags":[{"name":"for-developer","color":"599026","description":""}],"description":"この記事では RibbonCMS の初回セットアップ実行している `tie.sh` というシェルスクリプトについて、何をやっているのかをコードベースで解説します（実は、初回セットアップのほとんどはこの `tie.sh` で行われています）。  `tie.sh` のコードはこちらで確認できます:  > https://github.com/RibbonCMS/RibbonCMS/blob/main/..."},"config":{"blog_title":"RibbonCMS","site_introduction":"GitHub Issues driven Contents M@nagement System","copylight_name":"RibbonCMS team","copylight_url":"https://ribboncms.github.io","issues_page_url":"https://github.com/RibbonCMS/RibbonCMS.github.io/issues","favicon_image_url":"https://user-images.githubusercontent.com/55144709/217165705-8c5207fd-882f-44cc-a92d-a9646fcd6ff7.png","author_name":"RibbonCMS team","author_introduction":"We are RibbonCMS team.","avatar_image_url":{"url":"https://user-images.githubusercontent.com/55144709/217165705-8c5207fd-882f-44cc-a92d-a9646fcd6ff7.png","path":"/static/images/config/avatar.webp"},"sns":[{"name":"GitHub","url":"https://github.com/RibbonCMS/RibbonCMS/issues"}]},"postsMap":{"5":{"slug":"5","title":"RibbonCMS のセットアップ","tags":[{"name":"star","color":"006b75","description":"Require in FunctionalBlogTemplate (For pinned articles)"},{"name":"for-writer","color":"e99695","description":""}],"posted_at":"2023年02月07日 16時42分","content":"","updated_at":"","description":""},"6":{"slug":"6","title":"記事の投稿/編集/削除","tags":[{"name":"star","color":"006b75","description":"Require in FunctionalBlogTemplate (For pinned articles)"},{"name":"for-writer","color":"e99695","description":""}],"posted_at":"2023年02月07日 16時57分","content":"","updated_at":"","description":""},"7":{"slug":"7","title":"フロントエンドのテンプレート集","tags":[{"name":"star","color":"006b75","description":"Require in FunctionalBlogTemplate (For pinned articles)"},{"name":"for-writer","color":"e99695","description":""}],"posted_at":"2023年02月07日 17時38分","content":"","updated_at":"","description":""},"9":{"slug":"9","title":"RibbonCMS の Markdown 記法","tags":[{"name":"for-writer","color":"e99695","description":""}],"posted_at":"2023年07月30日 14時59分","content":"","updated_at":"","description":""}},"metadata":{"https://docs.github.com/ja/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax":{"url_domain":"docs.github.com","url_domain_link":"https://docs.github.com","title":"基本的な書き方とフォーマットの構文 - GitHub Docs","description":null,"image_url":"/static/images/external_ogp//513a2fe403a179cd13970f0e76bdc69e.webp","site_name":"GitHub Docs"}},"relatedPosts":[{"slug":"5","title":"RibbonCMS のセットアップ","tags":[{"name":"star","color":"006b75","description":"Require in FunctionalBlogTemplate (For pinned articles)"},{"name":"for-writer","color":"e99695","description":""}],"posted_at":"2023年02月07日 16時42分","content":"","updated_at":"","description":""},{"slug":"6","title":"記事の投稿/編集/削除","tags":[{"name":"star","color":"006b75","description":"Require in FunctionalBlogTemplate (For pinned articles)"},{"name":"for-writer","color":"e99695","description":""}],"posted_at":"2023年02月07日 16時57分","content":"","updated_at":"","description":""},{"slug":"9","title":"RibbonCMS の Markdown 記法","tags":[{"name":"for-writer","color":"e99695","description":""}],"posted_at":"2023年07月30日 14時59分","content":"","updated_at":"","description":""},{"slug":"7","title":"フロントエンドのテンプレート集","tags":[{"name":"star","color":"006b75","description":"Require in FunctionalBlogTemplate (For pinned articles)"},{"name":"for-writer","color":"e99695","description":""}],"posted_at":"2023年02月07日 17時38分","content":"","updated_at":"","description":""}]},"__N_SSG":true}